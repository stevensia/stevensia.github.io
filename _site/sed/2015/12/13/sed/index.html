<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="个人技术总结，读书笔记，心得等 | 这里是 Stevensia的个人博客，与君共勉。">
    <meta name="keyword"  content="Python, Steven的博客, Steven Blog, linux">
    <link rel="shortcut icon" href="img/favicon.ico">

    <title>sed基础总结和实战 - Steven's Blog!</title>

    <link rel="canonical" href="http://universus.cn/sed/2015/12/13/sed/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Steven's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About me</a>
                    </li>
                    
                    <li>
                        <a href="/portfolio/">Portfolio</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Image to hack wechat -->
<!-- <img src="/img/icon_wechat.png" width="0" height="0"> -->
<!-- <img src="/img/bigshows/geek_3.jpg" width="0" height="0"> -->

<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        background-image: url('/img/bigshows/geek_3.jpg')
    }
</style>
<header class="intro-header" >
    <div class="container">
        <div class="row">
            <div class="col-lg-9 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#sed" title="sed">sed</a>
                        
                    </div>
                    <h1>sed基础总结和实战</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by Steven's Blog on December 13, 2015</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-9 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

				<p><a href="http://book.douban.com/subject/1236944/">《sed与awk》</a>这本书值得一读，这里就捡基础的进行总结吧。</p>

<p>sed(stream editor) 非交互式流编辑器，通过多种转换修改流进它的文本，默认情况下sed并不会修改原文件本身。</p>

<p>sed处理以行为单位，一行行的读取和处理，所以可以用于处理大文件。语法如下：</p>

<pre><code>sed [options] 'command' file
</code></pre>

<p>下面以sed.txt文件为实战对象</p>

<pre><code>➜  ~  cat sed.txt 
this is line 1,this is First line
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line
</code></pre>

<h2 id="section">命令连接</h2>

<p>如将this改成That,line改成大写，<strong>注意两个编辑命令前要加-e参数，或分号连接两个编辑命令</strong></p>

<pre><code>➜  ~  sed -e 's/this/That/g' -e 's/line/LINE/g' sed.txt 
That is LINE 1,That is First LINE
That is LINE 2,the Second LINE, Empty LINE followed
That is LINE 4,That is Third LINE
That is LINE 5,That is Firth LINE

➜  ~  sed 's/this/That/g;s/line/LINE/g' sed.txt
That is LINE 1,That is First LINE
That is LINE 2,the Second LINE, Empty LINE followed
That is LINE 4,That is Third LINE
That is LINE 5,That is Firth LINE
</code></pre>

<h2 id="section-1">删除</h2>
<p>使用<code>d</code>(delete)命令删除指定的行</p>

<pre><code>#删除第一行,第N行则`Nd`
➜  ~  sed '1d' sed.txt 
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line
</code></pre>

<p>sed不会修改原文件，如果要保存则可使用<strong>重定向</strong>, <code>sed '1d' sed.txt &gt; saved file</code></p>

<p>或者如果想直接修改则直接<code>-i</code>参数:<code>sed -i '1d' sed.txt</code></p>

<pre><code>#删除指定范围，如1-3行,逗号分隔
➜  ~  sed '1, 3d' sed.txt
this is line 5,this is Firth line

#删除第一行到最后(正则$表示最后)一行
➜  ~  sed '1, $d' sed.txt

#删除最后一行
➜  ~  sed '$d' sed.txt 

#删除其他只保留第2行(正则`!`表示反)
➜  ~  sed '2!d' sed.txt
this is line 2,the Second line, Empty line followed

#删除所有包含Empty的行，(正则匹配Empty)
➜  ~  sed '/Empty/d' sed.txt
this is line 1,this is First line
this is line 4,this is Third line
this is line 5,this is Firth line

#删除空行
➜  ~  sed '/^$/d' sed.txt
</code></pre>

<p><strong>注意：在Mac OS X环境中</strong>,<code>-i</code> 需要带一个字符串，用来备份源文件，这个字符串加在源文件名后面组成备份文件名。<br />
如果这个字符串长度为0，就是说是个空串，那么不备份。</p>

<pre><code>sed -i "bs" 's/Atl/Dog/g' example.txt  
</code></pre>

<p>这样会生成一个example.txtbs的备份文件。</p>

<p>如果不备份，直接给个空</p>

<pre><code>sed -i "" 's/Atl/Dog/g' example.txt  
</code></pre>

<p>但是，不能省略，否则报错。</p>

<h2 id="section-2">查找替换</h2>
<p><code>s</code>命令用于替换文本，如：<code>s/line/LINE</code> 将line替换成LINE，<strong>注意默认情况下只替换第一次匹配到的内容</strong>。</p>

<pre><code>➜  ~  sed 's/line/LINE/' sed.txt
this is LINE 1,this is First line
this is LINE 2,the Second line, Empty line followed
this is LINE 4,this is Third line
this is LINE 5,this is Firth line
</code></pre>

<p>如果每行想多匹配n个则在其后输入n，如:</p>

<pre><code>➜  ~  sed 's/line/LINE/2' sed.txt
this is line 1,this is First LINE
this is line 2,the Second LINE, Empty line followed
this is line 4,this is Third LINE
this is line 5,this is Firth LINE
</code></pre>

<p>s命令利用g选项，可以完成所有匹配：</p>

<pre><code>➜  ~  sed 's/line/LINE/g' sed.txt
this is LINE 1,this is First LINE
this is LINE 2,the Second LINE, Empty LINE followed
this is LINE 4,this is Third LINE
this is LINE 5,this is Firth LINE
</code></pre>

<p>只替换指定位置的字符，如开头(<code>^</code>)，结尾(<code>$</code>)</p>

<pre><code>➜  ~  sed 's/^this/开头/g' sed.txt
开头 is line 1,this is First line
开头 is line 2,the Second line, Empty line followed
开头 is line 4,this is Third line
开头 is line 5,this is Firth line

➜  ~  sed 's/line$/结尾/g' sed.txt
this is line 1,this is First 结尾
this is line 2,the Second line, Empty line followed
this is line 4,this is Third 结尾
this is line 5,this is Firth 结尾
</code></pre>

<h2 id="section-3">字符转换</h2>
<p>使用<code>y</code>命令可进行字符转换,如下将文中所有大写字符，如FS等转换</p>

<pre><code>➜  ~  sed 'y/FSETF/!@#$%/' sed.txt
this is line 1,this is %irst line
this is line 2,the @econd line, #mpty line followed
this is line 4,this is $hird line
this is line 5,this is %irth line
</code></pre>

<p>或数字转换</p>

<pre><code>➜  ~  sed 'y/1245/ABDE/' sed.txt
this is line A,this is First line
this is line B,the Second line, Empty line followed
this is line D,this is Third line
this is line E,this is Firth line
</code></pre>

<h2 id="section-4">插入文本</h2>

<p>使用<code>i</code>,<code>a</code>命令插入文本，<code>i</code>插入在匹配之前，<code>a</code>插入到匹配后。a命令就是append， i命令就是insert。</p>

<pre><code>#在第二行插入
[beginman@iZ28tm3esnpZ ~]$ sed "2 i good" sed.txt
this is line 1,this is First line
good
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line 

[beginman@iZ28tm3esnpZ ~]$ sed "2 a good" sed.txt
this is line 1,this is First line
this is line 2,the Second line, Empty line followed
good
this is line 4,this is Third line
this is line 5,this is Firth line

#在最后一行追加
[beginman@iZ28tm3esnpZ ~]$ sed "$ a THE END" sed.txt
this is line 1,this is First line
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line
THE END

#在匹配上的一行插入，如匹配Second
[beginman@iZ28tm3esnpZ ~]$ sed '/Second/i\BBB' sed.txt
this is line 1,this is First line
BBB
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line
</code></pre>

<h2 id="section-5">读入文件</h2>

<p>使用<code>r</code>可以从其他文件中读取文本，并插入匹配行之后，如下：</p>

<pre><code>#将/etc/passwd中的内容读取放到匹配到Third之后
[beginman@iZ28tm3esnpZ ~]$ sed '/Third/r /etc/passwd' sed.txt
this is line 1,this is First line
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
...
this is line 5,this is Firth line
</code></pre>

<h2 id="section-6">打印</h2>
<p>使用命令<code>p</code>进行打印，必须使用<code>-n</code>参数表示不打印没关系的行，用于只显示我们想要的。</p>

<pre><code>#只打印第一行
[beginman@iZ28tm3esnpZ ~]$ sed -n '1p' sed.txt
this is line 1,this is First line

#sed是基于流的，所以所有流过的行都要打印
[beginman@iZ28tm3esnpZ ~]$ sed 's/the/THE/' sed.txt
this is line 1,this is First line
this is line 2,THE Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line

#使用p命令和-n参数简化了输出，只打印相关
[beginman@iZ28tm3esnpZ ~]$ sed -n 's/the/THE/p' sed.txt
this is line 2,THE Second line, Empty line followed
</code></pre>

<h2 id="section-7">写文件</h2>

<p>sed本身并写文件，只是对缓冲区的文本进行了修改并打印而已，如果要保存除了<code>-i</code>参数和重定向外，还可使用<code>w</code>	命令将结果保存外部指定文件如：</p>

<pre><code>#将sed.txt的1-2行保存到out.txt中
[beginman@iZ28tm3esnpZ ~]$ sed '1, 2 w out.txt' sed.txt
this is line 1,this is First line
this is line 2,the Second line, Empty line followed
this is line 4,this is Third line
this is line 5,this is Firth line
[beginman@iZ28tm3esnpZ ~]$ cat out.txt
this is line 1,this is First line
this is line 2,the Second line, Empty line followed

#加-n参数则不打印
[beginman@iZ28tm3esnpZ ~]$ sed -n '1, 2 w out.txt' sed.txt
</code></pre>

<h2 id="sed">sed脚本</h2>
<p>在生产环境中可能需要sed处理这样那样的数据，我们可将上面命令写入到文件中，然后调用sed命令并使用<code>-f</code>参数指定该文件，就能把一系列命令动作装载在一个文件中并应用于需要处理的数据中，这就是sed脚本</p>

<pre><code>#将this改成That,将字符STF改成123
[beginman@iZ28tm3esnpZ ~]$ cat mySed.rules
s/this/That/g
y/STF/123/

[beginman@iZ28tm3esnpZ ~]$ sed -f mySed.rules sed.txt
2hat is line 1,2hat is 3irst line
2hat is line 2,the 1econd line, Empty line followed
2hat is line 4,2hat is 2hird line
2hat is line 5,2hat is 3irth line
</code></pre>

<h2 id="sed-1">sed常用命令，参数，表达式</h2>

<p><img src="http://beginman.qiniudn.com/sed-command-1.png" alt="" /></p>

<p><img src="http://beginman.qiniudn.com/sed-command-2.png" alt="" /></p>

<p><img src="http://beginman.qiniudn.com/sed-options.png" alt="" /></p>

<p><img src="http://beginman.qiniudn.com/sed-re.png" alt="" /></p>

<p>参考：《Linux系统命令及Shell脚本实践指南》</p>



                <hr>

                


                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/awk/2015/12/13/awk/" data-toggle="tooltip" data-placement="top" title="awk基础总结和实战">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/python/2015/12/14/flask-projects-and-docs/" data-toggle="tooltip" data-placement="top" title="Flask项目和文档集">Next Post &rarr;</a>
                    </li>
                    
                </ul>


                

                

            </div>

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#linux基础" title="linux基础" rel="14">
                                    linux基础
                                </a>
                            
        				
                            
                				<a href="/tags/#Python" title="Python" rel="20">
                                    Python
                                </a>
                            
        				
                            
                				<a href="/tags/#linux服务器" title="linux服务器" rel="10">
                                    linux服务器
                                </a>
                            
        				
                            
                				<a href="/tags/#Mysql" title="Mysql" rel="11">
                                    Mysql
                                </a>
                            
        				
                            
                				<a href="/tags/#OS System" title="OS System" rel="7">
                                    OS System
                                </a>
                            
        				
                            
                				<a href="/tags/#python技巧" title="python技巧" rel="21">
                                    python技巧
                                </a>
                            
        				
                            
                				<a href="/tags/#redis" title="redis" rel="14">
                                    redis
                                </a>
                            
        				
                            
                				<a href="/tags/#django" title="django" rel="8">
                                    django
                                </a>
                            
        				
                            
                				<a href="/tags/#tornado" title="tornado" rel="6">
                                    tornado
                                </a>
                            
        				
                            
                				<a href="/tags/#Shell" title="Shell" rel="7">
                                    Shell
                                </a>
                            
        				
                            
                				<a href="/tags/#git" title="git" rel="5">
                                    git
                                </a>
                            
        				
                            
                				<a href="/tags/#web开发" title="web开发" rel="2">
                                    web开发
                                </a>
                            
        				
                            
                				<a href="/tags/#jQuery" title="jQuery" rel="3">
                                    jQuery
                                </a>
                            
        				
                            
                				<a href="/tags/#人生" title="人生" rel="4">
                                    人生
                                </a>
                            
        				
                            
                				<a href="/tags/#备份" title="备份" rel="2">
                                    备份
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Nginx" title="Nginx" rel="3">
                                    Nginx
                                </a>
                            
        				
                            
                				<a href="/tags/#windows服务器" title="windows服务器" rel="3">
                                    windows服务器
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#python模块" title="python模块" rel="2">
                                    python模块
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#运维" title="运维" rel="4">
                                    运维
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#python奇技淫巧" title="python奇技淫巧" rel="4">
                                    python奇技淫巧
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#python" title="python" rel="17">
                                    python
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Unix网络编程" title="Unix网络编程" rel="7">
                                    Unix网络编程
                                </a>
                            
        				
                            
                				<a href="/tags/#C" title="C" rel="2">
                                    C
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#ops" title="ops" rel="3">
                                    ops
                                </a>
                            
        				
                            
                				<a href="/tags/#book" title="book" rel="4">
                                    book
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#mongodb" title="mongodb" rel="6">
                                    mongodb
                                </a>
                            
        				
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("http://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/stevensia">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Steven's Blog 2016
                    <br>
                    Theme by <a href="http://huangxuan.me">Hux</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- Highlight.js -->
<script>
    async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
        hljs.initHighlightingOnLoad();
    })
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>
<link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">

<!--fastClick.js -->
<script>
    async("http://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->




<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
